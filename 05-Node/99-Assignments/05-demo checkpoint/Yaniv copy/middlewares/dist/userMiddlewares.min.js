"use strict";exports.__esModule=!0,exports.validatePassword=exports.encryptPassword=exports.doesUserExist=exports.isLoggedInAndAuthenticated=void 0;var secret=require("../../secret/dist/secret").secret,_a=require("../../models/dist/usersModel"),User=_a.User,Users=_a.Users,jwt=require("jsonwebtoken"),bcrypt=require("bcrypt");function isLoggedInAndAuthenticated(r,t,o){try{var e=r.cookies.currentUser;e?jwt.verify(e,secret,function(e,s){e?t.status(401).send({message:"You are not authorized to see this page, mister hacker..."}):(r.currentUser=s,o())}):t.status(401).send({message:"The session has expired. Please log in again."})}catch(e){console.error(e.message),t.status(500).send(e.message)}}function doesUserExist(e,s,r){try{var t=new Users;if(!e.currentUser){var o=e.body.email;return void(-1===(a=t.findUserIndex(null,o))?s.status(404).send({message:"User doesn't exist. Please register to the system."}):(e.userIndex=a,r()))}var a,n=e.currentUser.userUuid;void 0!==(a=t.findUserIndex(n,null))?(e.userUuid=n,e.userIndex=a,r()):s.status(404).send({message:"User wasn't found, mister hacker..."})}catch(e){console.error(e.message),s.status(500).send(e.message)}}function encryptPassword(r,t,o){try{var e=r.body.password;bcrypt.hash(e,10,function(e,s){try{if(e)throw new Error("Issues in the password encryption process!");r.body.password=s,o()}catch(e){console.error(e.message),t.status(500).send(e.message)}})}catch(e){console.error(e.message),t.status(500).send(e.message)}}function validatePassword(e,r,t){try{if(e.role)return void t();var s=e.body.password,o=new Users,a=e.userIndex,n=o.users[a].password;bcrypt.compare(s,n,function(e,s){try{if(e)throw r.status(409).send({message:"The password you entered is incorrect."});s?t():r.status(409).send({message:"The password you entered is incorrect."})}catch(e){console.error(e.message),r.status(500).send(e.message)}})}catch(e){console.error(e.message),r.status(500).send(e.message)}}exports.isLoggedInAndAuthenticated=isLoggedInAndAuthenticated,exports.doesUserExist=doesUserExist,exports.encryptPassword=encryptPassword,exports.validatePassword=validatePassword;