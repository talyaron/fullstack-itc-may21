"use strict";function _defineProperties(e,s){for(var r=0;r<s.length;r++){var t=s[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function _createClass(e,s,r){return s&&_defineProperties(e.prototype,s),r&&_defineProperties(e,r),e}function _classCallCheck(e,s){if(!(e instanceof s))throw new TypeError("Cannot call a class as a function")}var express=require("express"),app=express(),cookieParser=require("cookie-parser"),port=process.env.PORT||3e3;app.use(express.json());var Ajv=require("ajv"),ajv=new Ajv;app.use(express.static("public")),app.use(cookieParser());var User=function e(s,r,t){_classCallCheck(this,e),this.name=s,this.email=r,this.password=t,this.createdSurvey=[]},Users=function(){function e(){_classCallCheck(this,e),this.users=[]}return _createClass(e,[{key:"newUser",value:function(e){this.users.push(e)}}]),e}(),Survey=function e(s,r){_classCallCheck(this,e),this.surveyID=Math.random().toString(16).slice(2),this.title=s,this.admin=r,this.questions=[]},Surveys=function(){function e(){_classCallCheck(this,e),this.surveys=[]}return _createClass(e,[{key:"newSurvey",value:function(e){this.surveys.push(e)}}]),e}(),Question=function e(s){_classCallCheck(this,e),this.title=s,this.questionID=Math.random().toString(16).slice(2),this.voters={voterID:[],score:[]}},Questions=function(){function e(){_classCallCheck(this,e),this.questions=[]}return _createClass(e,[{key:"newQuestion",value:function(e){this.questions.push(e)}}]),e}(),users=new Users,selectedAdmin={};app.post("/createUser",function(e,s){try{var r=ajv.compile({type:"object",properties:{username:{type:"string"},password:{type:"string"},email:{type:"string"}},required:["username","password","email"],additionalProperties:!1}),t=e.body;if(!r(t))throw r.errors.forEach(function(e){return console.log(e.message)}),new Error("Invalid data was transferd");users.newUser(new User(t.username,t.email,t.password)),s.send(users)}catch(e){console.log(e),s.status(400).send({error:e.message})}}),app.post("/login",function(e,s){try{var r=ajv.compile({type:"object",properties:{password:{type:"string"},email:{type:"string"}},required:["password","email"],additionalProperties:!1}),t=e.body;if(!r(t))throw r.errors.forEach(function(e){return console.log(e.message)}),new Error("Invalid data was transferd");console.log(users),console.log(users.users),selectedAdmin=users.users.find(function(e){return e.email===t.email&&e.password===t.password}),console.log(selectedAdmin),s.send(selectedAdmin)}catch(e){console.log(e),s.status(400).send({error:e.message})}}),app.post("/addSurvey",function(e,s){try{var r=ajv.compile({type:"object",properties:{adminEmail:{type:"string"},surveyName:{type:"string"}},required:["surveyName","adminEmail"],additionalProperties:!1}),t=e.body;if(!r(t))throw r.errors.forEach(function(e){return console.log(e.message)}),new Error("Invalid data was transferd");users.users.map(function(e,s){e.email===t.adminEmail&&(users.users[s].createdSurvey.push(new Survey(t.surveyName,t.adminEmail)),selectedAdmin=users.users[s])}),s.send(selectedAdmin)}catch(e){console.log(e),s.status(400).send({error:e.message})}}),app.post("/postQuestions",function(e,s){try{var r=e.body,t=r.questions,n=r.surveyID;t.forEach(function(e){selectedAdmin.createdSurvey.find(function(e){return e.surveyID===n}).questions.push(new Question(e))}),s.send(selectedAdmin)}catch(e){console.log(e),s.status(400).send({error:e.message})}}),app.get("/selectedAdminUser",function(e,s){s.send(selectedAdmin)}),app.listen(port,function(){console.log("Server listen on port",port)});