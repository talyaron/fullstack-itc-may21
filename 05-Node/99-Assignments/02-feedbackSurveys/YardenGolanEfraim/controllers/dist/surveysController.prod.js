"use strict";var _require=require("../models.js"),Survey=_require.Survey,users=_require.users,getAdminCookie=_require.getAdminCookie,createAdminCookie=_require.createAdminCookie,getAdminCookieIndex=_require.getAdminCookieIndex,Ajv=require("ajv"),ajv=new Ajv;exports.delete_survey=function(e,r){try{var i=e.params.ID,s=getAdminCookie(e);s.createdSurvey=s.createdSurvey.filter(function(e){return e.surveyID!=i});var t=getAdminCookieIndex(e);users.users[t]=s,createAdminCookie(s,r),r.send(s)}catch(e){console.error(e)}},exports.send_survey=function(e,r){try{var i=e.query.id,s=JSON.stringify(i);r.cookie("surveyEditID",s,{maxAge:3e8,httpOnly:!0}),r.send(i)}catch(e){console.error(e)}},exports.add_survey=function(e,o){try{var r=ajv.compile({type:"object",properties:{adminEmail:{type:"string"},surveyName:{type:"string"}},required:["surveyName","adminEmail"],additionalProperties:!1}),n=e.body;if(!r(n))throw r.errors.forEach(function(e){return console.log(e.message)}),new Error("Invalid data was transferd");users.users.map(function(e,r){var i,s,t;e.email===n.adminEmail&&(users.users[r].createdSurvey.push(new Survey(n.surveyName,n.adminEmail)),i=users.users[r],s=r,createAdminCookie(i,o),t=JSON.stringify({selectedAdminIndex:s}),o.cookie("adminIndex",t,{maxAge:3e8,httpOnly:!0}),o.send(i))})}catch(e){console.log(e),o.status(400).send({error:e.message})}},exports.get_survey=function(e,r){try{var i=e.cookies.surveyEditID,s=JSON.parse(i),t=getAdminCookie(e).createdSurvey.filter(function(e){return e.surveyID===s});r.send(t)}catch(e){console.error(e)}},exports.survey_to_answer=function(e,r){var i=getAdminCookie(e),s=e.query.id,t=i.createdSurvey.filter(function(e){return e.surveyID===s});r.send(t)};