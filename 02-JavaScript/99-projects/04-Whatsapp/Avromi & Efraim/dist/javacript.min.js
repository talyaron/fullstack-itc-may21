var Contact=function(t,e,n,c){void 0===c&&(c=[{message:"New Conversation",timeStamp:new Date}]),this.name=t,this.imgUrl=e,this.phone=n,this.chats=c,this.contactId=Math.random().toString(16).slice(2)},Contacts=function(){function t(){this.contacts=[]}return t.prototype.addContact=function(t){try{this.contacts.unshift(t)}catch(t){console.error(t)}},t.prototype.renderContacts=function(t){try{var e=this.contacts.map(function(t){var e=new Date(t.chats[0].timeStamp),n=e.getHours(),c=e.getMinutes();return c<10&&(c="0"+c),'<div class="holder__contact" id="'+t.contactId+'" onclick="moveToPrivateChat(\''+t.contactId+'\')"><img class="holder__contact__image" src="'+t.imgUrl+'"><div class="holder__contact__name">'+t.name+'</div><div class="holder__contact__chat">'+t.chats[0].message+'</div><div class="holder__contact__timestamp">'+n+":"+c+'</div><div class="holder__contact__unread" id="delete" onclick="deleteContact(\''+t.contactId+"')\">x</div></div>"}).join("");t.innerHTML=e}catch(t){console.error(t)}},t.prototype.findIndexes=function(e){try{return this.contacts.findIndex(function(t){return t.contactId===e})}catch(t){console.error(t)}},t}(),contacts=new Contacts;function moveToPrivateChat(t){try{window.location.href="./private-chat.html?contactId="+t}catch(t){console.error(t)}}var image="";function getImgData(){try{var n=document.getElementById("file");n.addEventListener("change",function(){var t,e=n.files[0];e&&((t=new FileReader).readAsDataURL(e),t.addEventListener("load",function(){image=this.result}))})}catch(t){console.error(t)}}function handleSubmit(t){t.preventDefault();try{var e=image,n=t.target.children.name.value,c=t.target.children.number.value,o=document.querySelector(".holder");if(!o)throw new Error("No holder!");contacts.addContact(new Contact(n,e,c)),contacts.renderContacts(o),localStorage.setItem("contacts",JSON.stringify(contacts.contacts)),document.getElementById("myForm").style.display="none",t.target.reset()}catch(t){console.error(t)}}getImgData();var deleteContact=function(t){try{window.event.cancelBubble=!0,contacts.contacts=JSON.parse(localStorage.getItem("contacts"));var e=contacts.findIndexes(t);if(!contacts)throw new Error("No product list detected!");contacts.contacts.splice(e,1),addToDomWithArray(contacts.contacts),localStorage.setItem("contacts",JSON.stringify(contacts.contacts))}catch(t){console.error(t)}},addToDomWithArray=function(t){try{var a=document.querySelector(".holder");if(!a)throw new Error("No holder available!");if(a.innerHTML="",0===t.length)return void(a.innerHTML="no results available");t.forEach(function(t){var e=parseInt(t.chats.length-1),n=new Date(t.chats[e].timeStamp),c=n.getHours(),o=n.getMinutes();o<10&&(o="0"+o),a.innerHTML+='<div class="holder__contact" id="'+t.contactId+'" onclick="moveToPrivateChat(\''+t.contactId+'\')"><img class="holder__contact__image" src="'+t.imgUrl+'"><div class="holder__contact__name">'+t.name+'</a></div><div class="holder__contact__chat">'+t.chats[e].message+'</div><div class="holder__contact__timestamp">'+c+":"+o+'</div><div class="holder__contact__unread delete" onclick="deleteContact(\''+t.contactId+"')\">x</div></div>"})}catch(t){console.error(t)}},findContactSearch=function(t,e){try{var n=new RegExp(e,"gmi");return t.filter(function(t){return n.test(t.name)})}catch(t){console.error(t)}},findTextInMessages=function(t){try{var e=new RegExp(t,"i");return contacts.contacts.filter(function(t){return t.chats.some(function(t){return e.test(t.message)})})}catch(t){console.error(t)}},handleKeyUp=function(t){try{t.preventDefault();for(var e=t.target.value,n=findContactSearch(contacts.contacts,e),c=findTextInMessages(e),o=n.concat(c),a={},r=0;r<o.length;r++)a[o[r].name]=o[r];for(var i in o=new Array,a)o.push(a[i]);addToDomWithArray(o),0==e.length&&addToDomWithArray(contacts.contacts)}catch(t){console.error(t)}};function renderContactsFromLocalStorage(){try{window.addEventListener("load",function(){var t=JSON.parse(localStorage.getItem("contacts"));null!=t&&(addToDomWithArray(t),contacts.contacts=t)})}catch(t){console.error(t)}}function openForm(){try{document.querySelector(".header__new-convo").addEventListener("click",function(){document.getElementById("myForm").style.display="block"})}catch(t){console.error(t)}}function closeForm(){try{document.querySelector(".button--cancel").addEventListener("click",function(){document.getElementById("myForm").style.display="none"})}catch(t){console.error(t)}}function editButtonRevealAndHide(){try{document.querySelector(".header__edit").addEventListener("click",function(){for(var t=document.querySelectorAll(".holder__contact__unread"),e=document.querySelectorAll(".holder__contact__unread"),n=0;n<=t.length;n++)e[n].style.display="none",e[n].style.display="block"})}catch(t){console.error(t)}}renderContactsFromLocalStorage(),openForm(),closeForm(),editButtonRevealAndHide();