function setScrollHeight(){try{var e=document.querySelector(".messages");if(!e)throw new Error("No message div found!");e.scrollTop=e.scrollHeight}catch(e){console.error(e)}}function goBack(){try{window.location.href="index.html"}catch(e){console.error(e)}}window.onload=function(e){try{setScrollHeight()}catch(e){console.error(e)}};var urlSearchParams=new URLSearchParams(window.location.search);if(!urlSearchParams)throw new Error("No search params!");var params=Object.fromEntries(urlSearchParams.entries());if(!params)throw new Error("No params detected!");var allContacts=JSON.parse(localStorage.getItem("contacts"));if(!allContacts)throw new Error("Couldnt find anything in local storage!");var thisContact=allContacts.filter(function(e){return e.contactId===params.contactId}),index=allContacts.findIndex(function(e){return e.contactId===params.contactId}),contactName=document.querySelector(".nav__contact h2");contactName.innerHTML=""+thisContact[0].name;var contactImg=document.querySelector(".nav__img__wrapper");function updateLastSent(){try{var e=document.querySelector(".nav__contact p"),t=parseInt(thisContact[0].chats.length-1);e.innerHTML="Last Sent: "+thisContact[0].chats[t].timeStamp+" "}catch(e){console.error(e)}}function renderMessages(e){try{var a=document.querySelector(".messages"),r="";thisContact[0].chats.forEach(function(e){e.timeStamp=new Date(e.timeStamp);var t=e.timeStamp.getHours(),n=e.timeStamp.getMinutes();n<10&&(n="0"+n),r+='<div class="single__message" oncontextmenu = "contextHandler();return false;" >\n    <p>'+e.message+' </p>\n        <div class="single__message__timestamp"> '+t+":"+n+" </div>\n            </div>",a.innerHTML=r})}catch(e){console.error(e)}}function openCamera(){try{console.log("open the camera")}catch(e){console.error(e)}}function contextHandler(){try{document.getElementById("contextMenu").style.display="block",document.querySelector("html").addEventListener("click",function(){document.getElementById("contextMenu").style.display="none"})}catch(e){console.error(e)}}contactImg.innerHTML='<img class="nav__img"\nsrc="'+thisContact[0].imgUrl+'"\nalt = "" >';var form=document.querySelector(".form");function logSubmit(e){try{var t=e.target.elements.message.value,n=new Date,a={};a.message=t,a.timeStamp=n,thisContact[0].chats.push(a),e.preventDefault(),e.target.reset(),renderMessages(thisContact),updateLastSent(),setScrollHeight(),document.querySelector(".fa-microphone").style.display="block",document.querySelector(".fa-paper-plane").style.display="none",allContacts.splice(index,1),allContacts.unshift(thisContact[0]),localStorage.setItem("contacts",JSON.stringify(allContacts))}catch(e){console.error(e)}}function removeMic(){try{document.getElementById("input").addEventListener("keyup",function(){document.querySelector(".fa-microphone").style.display="none",document.querySelector(".fa-paper-plane").style.display="block"}),document.querySelector(".fa-microphone").disabled="true"}catch(e){console.error(e)}}form.addEventListener("submit",logSubmit),removeMic(),updateLastSent(),renderMessages(thisContact);